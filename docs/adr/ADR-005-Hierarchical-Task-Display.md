# ADR-005: 階層型タスク表示機能の実装

## ステータス

承認済み

## 日付

2025-03-03

## コンテキスト

Chute-kun アプリケーションでは、ユーザーのタスクをリスト形式で表示していたが、親タスクと子タスクの関係が視覚的に分かりにくかった。Todoist ではタスクが階層構造を持つことができるが、現在の CLI では平坦なリストとして表示されるため、関連するタスクの把握が困難であった。

## 決定

タスクを階層構造で表示する機能を実装する。具体的には以下の変更を行う：

1. `HierarchicalTask`型を定義し、親子関係を表現できるようにする
2. タスクフォーマッターに階層表示用の関数`displayTasksHierarchy`を追加する
3. インデントオプションを導入し、視覚的な階層表現をカスタマイズ可能にする
4. CLI コマンドに`--include-subtasks`オプションを追加し、サブタスクを含めた表示を可能にする

## 理由

1. 関連するタスクをグループ化して表示することで、ユーザーの理解を促進する
2. 複雑なプロジェクトやタスクの管理において、階層構造はより効率的な作業計画を可能にする
3. Todoist の API はすでに階層情報（parentId）を提供しており、この情報を有効活用すべきである
4. ユーザーフィードバックにおいて、タスクの関係性を視覚的に表現する機能への要望があった

## 影響

1. ユーザーエクスペリエンスの向上：関連タスクのグループ化により、作業の文脈が理解しやすくなる
2. 実装の複雑性：再帰的な表示ロジックが必要となり、コードの複雑性が増加する
3. テスト要件：階層構造の正確な表示を検証するための追加テストが必要となる
4. 将来の拡張性：この基盤を元に、階層フィルタリングや階層ごとの集計など、より高度な機能を実装できる

## 実装詳細

- `FormatTaskOptions`インターフェースに階層表示用のオプション（indentationString, maxDepth）を追加
- 再帰的にサブタスクを表示する`displayTasksHierarchy`関数を実装
- `showTodayTasks`や`filterTasks`などの CLI 機能に階層表示オプションを統合
- タスクが存在しない場合のフィードバックメッセージを追加

## 代替案

1. 平坦なリストを維持し、親タスクへの参照情報のみを表示する方法
2. 階層の代わりにタグやラベルによるグループ化を使用する方法
3. 視覚的な階層ではなく、タスク番号や ID による関係表現（例：1.1, 1.2, 2.1）を使用する方法

これらの代替案は実装が比較的容易であるが、視覚的な階層表現と比較してユーザー体験が劣ると判断した。

## 参考資料

- [Todoist のタスク階層構造 API 仕様](https://developer.todoist.com/rest/v2/#tasks)
- [コマンドラインでの階層表示のベストプラクティス](<https://en.wikipedia.org/wiki/Tree_(command)>)
