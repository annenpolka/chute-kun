# 開発ワークフロー: ドキュメント駆動開発とコミットフック

*最終更新日: 2025-03-01*

## 概要

TaskChuteプロジェクトでは、開発プロセスの各段階で適切なドキュメント化とコミットを厳密に実施するワークフローを採用します。これにより、コードとドキュメントの一貫性を保ち、開発履歴を明確に追跡可能にします。

## 作業後フック

すべての開発作業は、以下の「作業後フック」を伴って完了とみなします。これらのフックは省略不可の義務的なステップです。

### 1. ドキュメントフック

**すべての機能実装・変更後**に以下のドキュメント更新を行います：

1. **機能仕様の更新**
   - 新機能の場合: 対応する機能仕様ドキュメントを`docs/features/`に作成
   - 既存機能の修正: 該当する仕様ドキュメントを更新
   - インターフェース変更: APIドキュメントを更新

2. **テスト方針の文書化**
   - テストケースの選定理由
   - エッジケースと境界値の考慮
   - モックとスタブの利用方針

3. **アーキテクチャへの影響**
   - 既存ADRへの影響確認
   - 必要に応じて新ADRの作成または既存ADRの更新
   - システム概要図の更新（該当する場合）

4. **決定ログへの記録**
   - 実装中に行った重要な決定事項を`docs/decisions/log.md`に記録

### 2. コミットフック

ドキュメント更新後、以下の原則に従い**コミットを実施**します：

1. **原子的なコミット**
   - 1つの論理的変更に対して1つのコミット
   - コードとそれに対応するテスト・ドキュメントを同一コミットに含める

2. **意図の明確化**
   - コミットメッセージは変更内容を正確に説明
   - なぜその変更を行ったかの理由を含める
   - コミット戦略ドキュメントの規約に厳密に従う

3. **完全性の確保**
   - 未完成の機能は原則としてコミットしない
   - ただし、大きな機能は明確に区分されたサブタスクとして段階的にコミット可能

## ワークフローサイクル

以下のサイクルを各機能実装で繰り返します：

1. **計画フェーズ**
   - 機能要件の明確化
   - 実装アプローチの検討
   - 必要に応じた事前ADR作成

2. **テスト作成**（TDDのRed段階）
   - テストケースの作成
   - 失敗するテストの確認

3. **実装フェーズ**（TDDのGreen段階）
   - 最小限のコードで機能実装
   - テストが通ることを確認

4. **リファクタリング**（TDDのRefactor段階）
   - コード品質向上
   - テストの維持

5. **ドキュメントフック実行**
   - 上記のドキュメント更新手順を実施

6. **コミットフック実行**
   - 変更をコミット
   - コミットメッセージ規約に従う

7. **レビュー準備**
   - 変更のサマリー作成
   - 次のステップの決定

## 例外処理

以下の場合には特別な手順を適用します：

1. **実験的実装**
   - 実験ブランチを作成
   - 実験結果をドキュメント化した上でコミットまたは破棄

2. **緊急バグ修正**
   - 修正を即時適用
   - 事後的にドキュメントを更新
   - 根本原因分析と再発防止策を文書化

3. **大規模リファクタリング**
   - 変更計画を事前にドキュメント化
   - 段階的な適用と各段階でのテスト実行
   - 変更理由と影響をコミットメッセージに詳細記載

## 外部ライブラリ・APIの利用方針

外部ライブラリやAPIを適切に活用するため、以下の原則を遵守します：

### 型定義を優先的に確認

ライブラリやAPIの使用方法が不明確な場合、以下の順序で確認を行います：

1. **型定義ファイルの調査**
   - `.d.ts` ファイルを参照（`node_modules/@types/` または `node_modules/[パッケージ名]/`内）
   - インターフェース定義、型エイリアス、関数シグネチャを確認
   - オプショナル/必須パラメータの区別と初期値の確認

2. **実際の応答構造のロギング**
   - テスト段階でレスポンス構造を詳細にログ出力
   ```typescript
   console.log('Response type:', typeof response);
   console.log('Response structure:', JSON.stringify(response, null, 2));
   ```

3. **互換性を確保する実装**
   - バージョン変更や応答構造の変化に対応できる堅牢な実装
   ```typescript
   // 例: 複数形式に対応する実装
   const tasks = Array.isArray(response) 
     ? response 
     : (response.results || []);
   ```

4. **発見情報のドキュメント化**
   - API応答構造とその処理方法について学んだことをドキュメント化
   - 将来的な変更への対応指針を記録

## 自動化戦略

可能な限り、以下のプロセスの自動化を検討します：

1. **ドキュメントテンプレート生成**
   - 各種ドキュメントの標準テンプレート
   - 更新日時の自動挿入

2. **コミット前チェック**
   - ドキュメント更新の確認
   - コミットメッセージ形式の検証

3. **継続的レビュー**
   - ドキュメントとコードの一貫性確認
   - コミット履歴の品質監視

## まとめ

このワークフローにより、TaskChuteプロジェクトでは：

- コードとドキュメントが常に同期された状態を維持
- 開発の意思決定プロセスが明確に記録される
- プロジェクトの成長に伴い、ナレッジベースも体系的に拡充される

すべての開発作業において、ドキュメント化とコミットは単なる事務作業ではなく、**開発プロセスの本質的な構成要素**として扱われます。