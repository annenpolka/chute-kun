# タイムブロック生成機能

*最終更新日: 2025-03-01*

## 機能概要

タイムブロック生成機能は、TaskChuteの核心機能として、Todoistから取得した今日のタスクに対してLLMを活用して優先度と所要時間を予測し、1日のスケジュールを最適に構成します。

## ユースケース

1. **朝のスケジュール生成**
   - ユーザーが朝アプリを起動すると、その日のタスクに基づいて自動的にタイムブロックが生成される
   - 生成されたタイムブロックはカレンダービューで確認できる

2. **スケジュール調整**
   - タイムブロックの順序や時間枠を手動で調整可能
   - 新しいタスクが追加された場合、残りの時間に対して再最適化できる

3. **実績記録**
   - 各タスクの実際の所要時間を記録
   - 予測と実績の差異をLLMの学習データとして蓄積

## 入力データ

1. **Todoistデータ**
   - 今日期限のタスク一覧
   - 各タスクのプロジェクト、ラベル、優先度情報

2. **ユーザー設定**
   - 勤務開始・終了時間
   - 休憩パターン設定
   - 時間帯別の生産性プロファイル

3. **過去の実績データ**
   - 類似タスクの所要時間実績
   - 予測精度の履歴

## 出力データ

1. **タイムブロック配列**
   - タスクID
   - 開始・終了時刻
   - 予測所要時間
   - ステータス

2. **予測情報**
   - タスク別の予測根拠
   - 信頼度スコア
   - 考慮されたデータポイント

## アルゴリズム概要

1. **データ準備**
   - Todoistから今日のタスクを取得
   - 未完了タスクをフィルタリング
   - 過去の実績データを読み込み

2. **LLM優先度・時間予測**
   - タスク特性の抽出
   - 類似タスクのパターン認識
   - 各タスクの優先度と所要時間を予測

3. **タイムブロック最適化**
   - 優先度に基づくタスク並べ替え
   - 時間枠への割り当て
   - 休憩時間の挿入
   - 作業時間内に収まるよう調整

4. **スケジュール生成**
   - タイムブロックの時系列配置
   - 依存関係の考慮
   - 生産性パターンに基づく調整

## 例外処理

1. **過負荷の処理**
   - 予測タスク時間の合計が利用可能時間を超える場合
   - 優先度に基づいて一部タスクを翌日以降に移動するよう提案

2. **未知タスクの扱い**
   - 過去データがないタスクの場合
   - タスク名、プロジェクト、ラベルからの特徴抽出により予測

3. **中断・再開フロー**
   - スケジュールが中断された場合の残タスク再計画
   - 予期せぬタスク追加時の再最適化

## パフォーマンス要件

1. **応答時間**
   - タイムブロック初期生成: 5秒以内
   - スケジュール再最適化: 3秒以内

2. **予測精度**
   - 所要時間予測の誤差: 平均±20%以内（目標）
   - 優先度判定の正確性: 80%以上（ユーザー評価）

## 技術的依存性

1. **外部API**
   - Todoist REST API
   - LLM API (OpenAI/Anthropic)

2. **内部コンポーネント**
   - データモデル（Task, TimeBlock, Prediction）
   - ローカルストレージ
   - 通知システム

## テスト戦略

1. **ユニットテスト**
   - タスク取得とフィルタリング
   - タイムブロック生成アルゴリズム
   - 予測計算ロジック

2. **統合テスト**
   - Todoistデータ取得～タイムブロック生成の一連のフロー
   - LLM API連携
   - ユーザー設定の反映

3. **実績データを用いたバックテスト**
   - 過去のデータを用いた予測精度の検証
   - さまざまなタスクパターンでのアルゴリズム評価