# 実装状況と進捗

*最終更新日: 2025-03-03*

## 現在の実装状況

### 1. プロジェクト構成

```
src/
  ├── lib/
  │   └── todoistClient.ts  # Todoist API操作関数
  ├── tests/
  │   └── todoistClient.test.ts  # テストコード
  └── index.ts  # エントリーポイント
```

- TypeScript環境の設定完了
- Jest によるテスト環境の構築完了
- 基本的なプロジェクト設定ファイル（package.json、tsconfig.json）の設定完了
- 関数ベースのアーキテクチャを採用

### 2. 実装済み機能

#### Todoist APIクライアント

- `createTodoistApi()`: APIトークンからTodoist APIクライアントを作成
- `getTasks()`: 条件付きタスク検索機能
  - プロジェクトID
  - ラベル
  - 期限日
  - 完了状態
  - 優先度
  でのフィルタリングをサポート
- `getTodayTasks()`: 今日期限の未完了タスク取得

#### コマンドラインインターフェース

- `today`: 今日期限のタスク一覧表示
- `filter`: 条件指定によるタスクフィルタリング
  - `--project`: プロジェクトIDでフィルタリング
  - `--labels`: ラベルでフィルタリング（カンマ区切りで複数指定可）
  - `--due`: 期限日でフィルタリング（YYYY-MM-DD形式）
  - `--completed`: 完了状態でフィルタリング（true/false）
  - `--priority`: 優先度でフィルタリング（1-4）
- `help`: 使用方法の表示
- `--token`: コマンドラインからのTodoist APIトークン指定

### 3. テスト状況

- ユニットテスト: 11テストケース（全て成功）
  - API接続テスト
  - フィルタリングテスト
  - エラー処理テスト

### 4. 技術スタック

- 言語: TypeScript
- ランタイム: Node.js
- パッケージ管理: npm
- テストフレームワーク: Jest
- 外部API: Todoist REST API v2

### 5. 設計アプローチ

- 関数ベース: クラスを使わない純粋関数のアプローチを採用
- モジュール分割: 機能ごとに適切にモジュール化
- 型安全性: TypeScriptの静的型チェックを活用
- TDD: テスト駆動開発を実践

## 次のマイルストーン

### 短期目標（優先度高）

1. **タスクの優先度分析機能**
   - 各タスクの優先度・緊急度を評価する関数の実装
   - タスク内容、ラベル、プロジェクトから優先度を算出

2. **所要時間予測機能**
   - タスクの所要時間を予測する関数の実装
   - 過去のログがない場合の仮定値の設定

3. **タイムブロック生成ロジック**
   - 優先度と所要時間に基づいたスケジューリングアルゴリズム
   - 一日の時間枠内にタスクを適切に配置

### 中期目標

1. **CLIインターフェース**
   - コマンドライン引数の処理
   - インタラクティブなCLIエクスペリエンス

2. **実績記録機能**
   - タスク開始・完了のタイムスタンプ記録
   - 実績と予測の差分分析

3. **設定管理**
   - ユーザー設定の保存と読み込み
   - カスタマイズ可能なパラメータ

### 長期目標

1. **LLM統合**
   - Gemini API連携
   - タスク分析の精度向上

2. **学習機能**
   - 過去の実績データからの学習
   - 予測精度の継続的改善

## 既知の課題

1. Todoist APIの型定義の扱いが不完全（any型の使用）
2. エラーハンドリングの改善が必要
3. 環境変数管理の強化
4. 新しいTodoist APIとの互換性調整（レスポンス形式の差異）
5. APIトークンが無効な場合のエラー表示の改善

## 環境設定

### 環境変数
`.env` ファイルで以下の設定が可能:

```
# Todoist API の設定
TODOIST_API_TOKEN=your_todoist_api_token_here

# アプリケーション設定
APP_ENV=development  # development, production
LOG_LEVEL=debug      # debug, info, warn, error
```

### 実行方法

```bash
# 開発モード実行
npm run dev -- today
npm run dev -- filter --priority 4 --project プロジェクトID

# ビルド実行
npm run build
npm start -- today

# トークン直接指定
npm run dev -- today --token your_todoist_api_token
```

## 次のステップ

1. タスクモデルの拡張（所要時間や優先度の追加）
2. タイムブロックモデルの実装
3. スケジューリングアルゴリズムの実装
4. データの永続化（ローカルストレージの実装）
5. レポート生成機能の追加