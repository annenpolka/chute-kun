# 日本語入力（IME）トラブルシューティングと使用ガイド

最終更新: 2025-08-30

本アプリは IME を用いた日本語入力に対応しています。ここでは入力手順と、うまく入力できない場合の確認ポイントをまとめます。

## 基本の使い方（入力モード）
- `i`: 新規タスクの入力モードに入ります
- ターミナルで IME を起動し、日本語を変換・確定します
- `Enter`: 入力中のタイトルでタスクを追加
- `Esc`: キャンセル
- `Backspace`: 1 文字（1 Unicode スカラ）削除
- 貼り付け（Cmd+V / Ctrl+V）: 入力モード中は貼り付け文字列をそのまま追記します（日本語可）

ヒント: 変換中（未確定）のテキストはターミナルや IME の挙動に依存します。確定後の文字列がプロンプトに反映されます。

## うまく入力できないとき
1. まず入力モードであることを確認
   - 画面に `Input: <text> _  (Enter=Add Esc=Cancel)` と表示されているか確認
2. 貼り付けで回避できるかを確認
   - クリップボードに日本語をコピー→入力モードで貼り付け（サポート済）
3. 修飾キー（例: `Shift+Enter`）が効かない
   - 代替キー `f` でも Finish できます（ヘルプ行参照）
4. ターミナル設定の確認
   - 一部設定（全てのキーをエスケープとして送る等）では IME 入力が壊れることがあります
   - 本アプリは IME 互換性を優先するフラグ構成で動作します（詳細は ADR-004）

## 実装メモ（開発者向け）
- キーボード拡張フラグ: `DISAMBIGUATE_ESCAPE_CODES | REPORT_EVENT_TYPES` のみ有効化
- CSI-u（`REPORT_ALL_KEYS_AS_ESCAPE_CODES`）は無効化（IME 互換性のため）
- `Event::Paste` を取り込み、`App::handle_paste(&str)` で入力バッファへ追記
- テスト: `tests/app_japanese_input_test.rs` に日本語入力・削除・貼り付けの検証を追加

関連: `docs/adr/ADR-004-Keyboard-Enhancement-IME-Compatibility.md`

